Incorporate foreach and guards with monadic operations in Free Monads.
